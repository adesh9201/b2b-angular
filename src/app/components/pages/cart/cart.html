<!-- Cart Container -->
<div class="cart-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Loading your cart...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="container mt-5">
    <div class="alert alert-danger text-center" role="alert">
      <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
      <h4>Oops! Something went wrong</h4>
      <p>{{ error }}</p>
      <button class="btn btn-primary" (click)="loadCartItems()">
        <i class="fas fa-redo me-2"></i>Try Again
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && !error">
    <!-- Page Header -->
    <section class="bg-light py-4">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6">
            <h1 class="fw-bold mb-2">Shopping Cart</h1>
            <p class="text-muted mb-0">
              <i class="fas fa-shopping-cart me-2"></i>
              {{ getTotalItems() }} item{{ getTotalItems() !== 1 ? 's' : '' }} in your cart
            </p>
          </div>
          <div class="col-md-6 text-md-end">
            <button class="btn btn-outline-primary me-2" (click)="continueShopping()">
              <i class="fas fa-arrow-left me-1"></i>Continue Shopping
            </button>
            <button *ngIf="cartItems.length > 0" class="btn btn-outline-danger" (click)="clearCart()">
              <i class="fas fa-trash me-1"></i>Clear Cart
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Cart Content -->
    <section class="py-5" *ngIf="cartItems.length > 0; else emptyCart">
      <div class="container">
        <div class="row g-4">
          
          <!-- Cart Items -->
          <div class="col-lg-8">
            <div class="card shadow-sm">
              <div class="card-header bg-white">
                <h5 class="mb-0">
                  <i class="fas fa-shopping-cart me-2 text-primary"></i>Cart Items
                </h5>
              </div>
              <div class="card-body p-0">
                <div *ngFor="let item of cartItems; let last = last" 
                     class="d-flex p-3 align-items-center"
                     [class.border-bottom]="!last">
                  <img [src]="item.image" [alt]="item.name" class="cart-item-image me-3">
                  <div class="flex-grow-1">
                    <h6 class="mb-1 fw-bold">{{ item.name }}</h6>
                    <p class="text-muted mb-2">${{ item.price | number:'1.2-2' }} per unit</p>
                    <div class="d-flex align-items-center">
                      <div class="quantity-controls me-3">
                        <button class="btn btn-sm btn-outline-secondary"
                                (click)="decreaseQuantity(item)"
                                [disabled]="item.quantity <= 1">
                          <i class="fas fa-minus"></i>
                        </button>
                        <input type="number" 
                               min="1" 
                               max="99"
                               class="form-control form-control-sm text-center mx-2"
                               style="width: 60px;"
                               [(ngModel)]="item.quantity"
                               (change)="updateQuantity(item, item.quantity)">
                        <button class="btn btn-sm btn-outline-secondary"
                                (click)="increaseQuantity(item)"
                                [disabled]="item.quantity >= 99">
                          <i class="fas fa-plus"></i>
                        </button>
                      </div>
                      <div class="item-total me-3">
                        <span class="fw-bold">${{ (item.price * item.quantity) | number:'1.2-2' }}</span>
                      </div>
                      <button class="btn btn-sm btn-outline-danger" 
                              (click)="removeItem(item)"
                              title="Remove item">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Order Summary -->
          <div class="col-lg-4">
            <div class="card shadow-sm mb-4">
              <div class="card-header bg-white">
                <h5 class="mb-0">
                  <i class="fas fa-receipt me-2 text-primary"></i>Order Summary
                </h5>
              </div>
              <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                  <span>Subtotal ({{ getTotalItems() }} items):</span>
                  <strong>${{ orderSummary.subtotal | number:'1.2-2' }}</strong>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>Shipping:</span>
                  <strong>${{ orderSummary.shipping | number:'1.2-2' }}</strong>
                </div>
                <div *ngIf="orderSummary.discount > 0" class="d-flex justify-content-between mb-2 text-success">
                  <span>Discount:</span>
                  <strong>-${{ orderSummary.discount | number:'1.2-2' }}</strong>
                </div>
                <hr>
                <div class="d-flex justify-content-between fw-bold fs-5">
                  <span>Total:</span>
                  <span class="text-primary">${{ orderSummary.total | number:'1.2-2' }}</span>
                </div>
              </div>
            </div>

            <!-- Shipping Options -->
            <div class="card shadow-sm mb-4">
              <div class="card-header bg-white">
                <h6 class="mb-0">
                  <i class="fas fa-truck me-2 text-primary"></i>Shipping Options
                </h6>
              </div>
              <div class="card-body">
                <div class="form-check mb-3">
                  <input class="form-check-input" 
                         type="radio" 
                         name="shipping" 
                         value="standard" 
                         checked
                         (change)="selectShipping('standard')">
                  <label class="form-check-label d-flex justify-content-between">
                    <span>Standard Shipping</span>
                    <span class="text-muted">$15.00</span>
                  </label>
                  <small class="text-muted d-block">5-7 business days</small>
                </div>
                <div class="form-check mb-3">
                  <input class="form-check-input" 
                         type="radio" 
                         name="shipping" 
                         value="express"
                         (change)="selectShipping('express')">
                  <label class="form-check-label d-flex justify-content-between">
                    <span>Express Shipping</span>
                    <span class="text-muted">$25.00</span>
                  </label>
                  <small class="text-muted d-block">2-3 business days</small>
                </div>
                <div class="form-check">
                  <input class="form-check-input" 
                         type="radio" 
                         name="shipping" 
                         value="overnight"
                         (change)="selectShipping('overnight')">
                  <label class="form-check-label d-flex justify-content-between">
                    <span>Overnight Shipping</span>
                    <span class="text-muted">$45.00</span>
                  </label>
                  <small class="text-muted d-block">Next business day</small>
                </div>
              </div>
            </div>

            <!-- Promo Code -->
            <div class="card shadow-sm mb-4">
              <div class="card-header bg-white">
                <h6 class="mb-0">
                  <i class="fas fa-tag me-2 text-primary"></i>Promo Code
                </h6>
              </div>
              <div class="card-body">
                <div class="input-group mb-2">
                  <input type="text" 
                         class="form-control" 
                         [(ngModel)]="promoCode"
                         placeholder="Enter promo code"
                         (keyup.enter)="applyPromoCode()">
                  <button class="btn btn-outline-primary" 
                          (click)="applyPromoCode()"
                          [disabled]="!promoCode.trim()">
                    Apply
                  </button>
                </div>
                <div *ngIf="promoMessage" 
                     class="alert alert-sm"
                     [class.alert-success]="promoMessage.includes('applied')"
                     [class.alert-danger]="!promoMessage.includes('applied')"
                     role="alert">
                  {{ promoMessage }}
                </div>
                <small class="text-muted">Try "SAVE10" for 10% off</small>
              </div>
            </div>

            <!-- Checkout Button -->
            <button class="btn btn-primary btn-lg w-100" 
                    (click)="openCheckout()"
                    [disabled]="cartItems.length === 0">
              <i class="fas fa-lock me-2"></i>Proceed to Checkout
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Empty Cart State -->
    <ng-template #emptyCart>
      <div class="text-center py-5">
        <div class="container">
          <div class="empty-cart-icon mb-4">
            <i class="fas fa-shopping-cart"></i>
          </div>
          <h3 class="text-muted mb-3">Your cart is empty</h3>
          <p class="text-muted mb-4">Looks like you haven't added any fabrics to your cart yet.</p>
          <button class="btn btn-primary btn-lg" (click)="continueShopping()">
            <i class="fas fa-shopping-bag me-2"></i>Start Shopping
          </button>
        </div>
      </div>
    </ng-template>
  </div>
</div>
