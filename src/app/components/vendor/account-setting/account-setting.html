<div class="vendor-layout">
  <app-sidebar></app-sidebar>
  
  <div class="main-content">
    <div class="container-fluid">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="mb-1">Account Settings</h2>
          <p class="text-muted mb-0">Manage your vendor profile and preferences</p>
        </div>
      </div>

      <!-- Success Message -->
      <div *ngIf="showSuccessMessage" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        Settings updated successfully!
        <button type="button" class="btn-close" (click)="showSuccessMessage = false"></button>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading account settings...</p>
      </div>

      <!-- Settings Content -->
      <div *ngIf="!isLoading" class="row">
        <!-- Profile Settings -->
        <div class="col-lg-8">
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-user me-2"></i>Profile Information
              </h5>
            </div>
            <div class="card-body">
              <form [formGroup]="profileForm" (ngSubmit)="onProfileSubmit()">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="businessName" class="form-label">Business Name</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      id="businessName" 
                      formControlName="businessName"
                      [class.is-invalid]="profileForm.get('businessName')?.invalid && profileForm.get('businessName')?.touched"
                    >
                    <div class="invalid-feedback" *ngIf="profileForm.get('businessName')?.invalid && profileForm.get('businessName')?.touched">
                      {{ getErrorMessage('businessName', profileForm) }}
                    </div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="contactPerson" class="form-label">Contact Person</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      id="contactPerson" 
                      formControlName="contactPerson"
                      [class.is-invalid]="profileForm.get('contactPerson')?.invalid && profileForm.get('contactPerson')?.touched"
                    >
                    <div class="invalid-feedback" *ngIf="profileForm.get('contactPerson')?.invalid && profileForm.get('contactPerson')?.touched">
                      {{ getErrorMessage('contactPerson', profileForm) }}
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="businessDescription" class="form-label">Business Description</label>
                  <textarea 
                    class="form-control" 
                    id="businessDescription" 
                    rows="3" 
                    formControlName="businessDescription"
                    [class.is-invalid]="profileForm.get('businessDescription')?.invalid && profileForm.get('businessDescription')?.touched"
                  ></textarea>
                  <div class="invalid-feedback" *ngIf="profileForm.get('businessDescription')?.invalid && profileForm.get('businessDescription')?.touched">
                    {{ getErrorMessage('businessDescription', profileForm) }}
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="email" class="form-label">Email Address</label>
                    <input 
                      type="email" 
                      class="form-control" 
                      id="email" 
                      formControlName="email"
                      [class.is-invalid]="profileForm.get('email')?.invalid && profileForm.get('email')?.touched"
                    >
                    <div class="invalid-feedback" *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched">
                      {{ getErrorMessage('email', profileForm) }}
                    </div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="phone" class="form-label">Phone Number</label>
                    <input 
                      type="tel" 
                      class="form-control" 
                      id="phone" 
                      formControlName="phone"
                      [class.is-invalid]="profileForm.get('phone')?.invalid && profileForm.get('phone')?.touched"
                    >
                    <div class="invalid-feedback" *ngIf="profileForm.get('phone')?.invalid && profileForm.get('phone')?.touched">
                      {{ getErrorMessage('phone', profileForm) }}
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="businessType" class="form-label">Business Type</label>
                  <select 
                    class="form-select" 
                    id="businessType" 
                    formControlName="businessType"
                    [class.is-invalid]="profileForm.get('businessType')?.invalid && profileForm.get('businessType')?.touched"
                  >
                    <option value="">Select Business Type</option>
                    <option value="manufacturer">Manufacturer</option>
                    <option value="wholesaler">Wholesaler</option>
                    <option value="retailer">Retailer</option>
                    <option value="distributor">Distributor</option>
                    <option value="importer">Importer</option>
                    <option value="exporter">Exporter</option>
                  </select>
                  <div class="invalid-feedback" *ngIf="profileForm.get('businessType')?.invalid && profileForm.get('businessType')?.touched">
                    {{ getErrorMessage('businessType', profileForm) }}
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label">Business Address</label>
                  <div formGroupName="address">
                    <div class="row">
                      <div class="col-12 mb-3">
                        <input 
                          type="text" 
                          class="form-control" 
                          placeholder="Street Address"
                          formControlName="street"
                          [class.is-invalid]="profileForm.get('address.street')?.invalid && profileForm.get('address.street')?.touched"
                        >
                        <div class="invalid-feedback" *ngIf="profileForm.get('address.street')?.invalid && profileForm.get('address.street')?.touched">
                          Street address is required
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-4 mb-3">
                        <input 
                          type="text" 
                          class="form-control" 
                          placeholder="City"
                          formControlName="city"
                          [class.is-invalid]="profileForm.get('address.city')?.invalid && profileForm.get('address.city')?.touched"
                        >
                        <div class="invalid-feedback" *ngIf="profileForm.get('address.city')?.invalid && profileForm.get('address.city')?.touched">
                          City is required
                        </div>
                      </div>
                      <div class="col-md-4 mb-3">
                        <input 
                          type="text" 
                          class="form-control" 
                          placeholder="State/Province"
                          formControlName="state"
                          [class.is-invalid]="profileForm.get('address.state')?.invalid && profileForm.get('address.state')?.touched"
                        >
                        <div class="invalid-feedback" *ngIf="profileForm.get('address.state')?.invalid && profileForm.get('address.state')?.touched">
                          State is required
                        </div>
                      </div>
                      <div class="col-md-4 mb-3">
                        <input 
                          type="text" 
                          class="form-control" 
                          placeholder="ZIP/Postal Code"
                          formControlName="zipCode"
                          [class.is-invalid]="profileForm.get('address.zipCode')?.invalid && profileForm.get('address.zipCode')?.touched"
                        >
                        <div class="invalid-feedback" *ngIf="profileForm.get('address.zipCode')?.invalid && profileForm.get('address.zipCode')?.touched">
                          ZIP code is required
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <input 
                          type="text" 
                          class="form-control" 
                          placeholder="Country"
                          formControlName="country"
                          [class.is-invalid]="profileForm.get('address.country')?.invalid && profileForm.get('address.country')?.touched"
                        >
                        <div class="invalid-feedback" *ngIf="profileForm.get('address.country')?.invalid && profileForm.get('address.country')?.touched">
                          Country is required
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <button 
                  type="submit" 
                  class="btn btn-primary"
                  [disabled]="profileForm.invalid || isSaving"
                >
                  <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-2"></span>
                  {{ isSaving ? 'Saving...' : 'Update Profile' }}
                </button>
              </form>
            </div>
          </div>

          <!-- Password Change -->
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-lock me-2"></i>Change Password
              </h5>
            </div>
            <div class="card-body">
              <form [formGroup]="passwordForm" (ngSubmit)="onPasswordSubmit()">
                <div class="row">
                  <div class="col-md-4 mb-3">
                    <label for="currentPassword" class="form-label">Current Password</label>
                    <input 
                      type="password" 
                      class="form-control" 
                      id="currentPassword" 
                      formControlName="currentPassword"
                      [class.is-invalid]="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched"
                    >
                    <div class="invalid-feedback" *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
                      {{ getErrorMessage('currentPassword', passwordForm) }}
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="newPassword" class="form-label">New Password</label>
                    <input 
                      type="password" 
                      class="form-control" 
                      id="newPassword" 
                      formControlName="newPassword"
                      [class.is-invalid]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched"
                    >
                    <div class="invalid-feedback" *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
                      {{ getErrorMessage('newPassword', passwordForm) }}
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="confirmPassword" class="form-label">Confirm Password</label>
                    <input 
                      type="password" 
                      class="form-control" 
                      id="confirmPassword" 
                      formControlName="confirmPassword"
                      [class.is-invalid]="passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmPassword')?.touched"
                    >
                    <div class="invalid-feedback" *ngIf="passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmPassword')?.touched">
                      {{ getPasswordMismatchError() }}
                    </div>
                  </div>
                </div>
                <button 
                  type="submit" 
                  class="btn btn-warning"
                  [disabled]="passwordForm.invalid || isSaving"
                >
                  <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-2"></span>
                  {{ isSaving ? 'Updating...' : 'Change Password' }}
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
          <!-- Account Status -->
          <div class="card mb-4">
            <div class="card-header">
              <h6 class="mb-0">Account Status</h6>
            </div>
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <span class="badge me-2" [class]="getStatusBadgeClass(currentVendor?.status || 'pending')">
                  {{ getStatusText(currentVendor?.status || 'pending') }}
                </span>
                <small class="text-muted">Account Status</small>
              </div>
              <div class="d-flex align-items-center mb-3">
                <i class="fas fa-star text-warning me-2"></i>
                <span class="fw-bold">{{ currentVendor?.rating || 0 }}</span>
                <small class="text-muted ms-1">Average Rating</small>
              </div>
              <div class="d-flex align-items-center mb-3">
                <i class="fas fa-box text-primary me-2"></i>
                <span class="fw-bold">{{ currentVendor?.totalProducts || 0 }}</span>
                <small class="text-muted ms-1">Total Products</small>
              </div>
              <div class="d-flex align-items-center">
                <i class="fas fa-shopping-cart text-success me-2"></i>
                <span class="fw-bold">{{ currentVendor?.totalOrders || 0 }}</span>
                <small class="text-muted ms-1">Total Orders</small>
              </div>
            </div>
          </div>

          <!-- Notification Settings -->
          <div class="card">
            <div class="card-header">
              <h6 class="mb-0">Notification Preferences</h6>
            </div>
            <div class="card-body">
              <form [formGroup]="notificationForm" (ngSubmit)="onNotificationSubmit()">
                <div class="form-check mb-3">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    id="emailNotifications" 
                    formControlName="emailNotifications"
                  >
                  <label class="form-check-label" for="emailNotifications">
                    Email notifications
                  </label>
                </div>
                <div class="form-check mb-3">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    id="orderNotifications" 
                    formControlName="orderNotifications"
                  >
                  <label class="form-check-label" for="orderNotifications">
                    New order alerts
                  </label>
                </div>
                <div class="form-check mb-3">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    id="stockAlerts" 
                    formControlName="stockAlerts"
                  >
                  <label class="form-check-label" for="stockAlerts">
                    Low stock alerts
                  </label>
                </div>
                <div class="form-check mb-3">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    id="marketingEmails" 
                    formControlName="marketingEmails"
                  >
                  <label class="form-check-label" for="marketingEmails">
                    Marketing emails
                  </label>
                </div>
                <div class="form-check mb-3">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    id="smsNotifications" 
                    formControlName="smsNotifications"
                  >
                  <label class="form-check-label" for="smsNotifications">
                    SMS notifications
                  </label>
                </div>
                <button 
                  type="submit" 
                  class="btn btn-outline-primary btn-sm w-100"
                  [disabled]="isSaving"
                >
                  <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-2"></span>
                  {{ isSaving ? 'Saving...' : 'Save Preferences' }}
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
