<div class="vendor-layout">
  <app-sidebar></app-sidebar>
  
  <div class="main-content">
    <div class="container-fluid">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="mb-1">Product Catalog</h2>
          <p class="text-muted mb-0">Manage your product inventory</p>
        </div>
        <button class="btn btn-primary" (click)="openAddModal()">
          <i class="fas fa-plus me-2"></i>Add Product
        </button>
      </div>

      <!-- Filters and Search -->
      <div class="row mb-4">
        <div class="col-md-4">
          <input 
            type="text" 
            class="form-control" 
            placeholder="Search products..."
            [(ngModel)]="searchQuery"
          >
        </div>
        <div class="col-md-3">
          <select class="form-select" [(ngModel)]="selectedCategory">
            <option value="">All Categories</option>
            <option value="cotton">Cotton</option>
            <option value="silk">Silk</option>
            <option value="wool">Wool</option>
            <option value="synthetic">Synthetic</option>
          </select>
        </div>
        <div class="col-md-3">
          <select class="form-select" [(ngModel)]="selectedStatus">
            <option value="">All Status</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>
        <div class="col-md-2">
          <button class="btn btn-outline-secondary w-100" (click)="loadProducts()">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading products...</p>
      </div>

      <!-- Products Grid -->
      <div *ngIf="!isLoading" class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Products ({{ getFilteredProducts().length }})</h5>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-hover mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Product</th>
                      <th>Category</th>
                      <th>Price</th>
                      <th>Stock</th>
                      <th>Status</th>
                      <th>Rating</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let product of getFilteredProducts()">
                      <td>
                        <div class="d-flex align-items-center">
                          <img [src]="product.imageUrl" [alt]="product.name" class="product-thumb me-3">
                          <div>
                            <h6 class="mb-1">{{ product.name }}</h6>
                            <small class="text-muted">{{ product.description | truncate:50 }}</small>
                          </div>
                        </div>
                      </td>
                      <td>
                        <span class="badge bg-secondary">{{ product.category }}</span>
                      </td>
                      <td>
                        <strong>{{ product.price | currencyFormat }}</strong>
                        <small class="text-muted d-block">per {{ product.unit }}</small>
                      </td>
                      <td>
                        <span [class]="product.stockQuantity < 50 ? 'text-danger' : 'text-success'">
                          {{ product.stockQuantity }} {{ product.unit }}
                        </span>
                      </td>
                      <td>
                        <div class="form-check form-switch">
                          <input 
                            class="form-check-input" 
                            type="checkbox" 
                            [checked]="product.isActive"
                            (change)="toggleProductStatus(product)"
                          >
                          <label class="form-check-label">
                            {{ product.isActive ? 'Active' : 'Inactive' }}
                          </label>
                        </div>
                      </td>
                      <td>
                        <div class="d-flex align-items-center">
                          <i class="fas fa-star text-warning me-1"></i>
                          <span>{{ product.rating }}</span>
                          <small class="text-muted ms-1">({{ product.totalOrders }})</small>
                        </div>
                      </td>
                      <td>
                        <div class="btn-group" role="group">
                          <button class="btn btn-sm btn-outline-primary" (click)="openEditModal(product)">
                            <i class="fas fa-edit"></i>
                          </button>
                          <button class="btn btn-sm btn-outline-danger" (click)="deleteProduct(product.id)">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && getFilteredProducts().length === 0" class="text-center py-5">
        <i class="fas fa-box fa-3x text-muted mb-3"></i>
        <h5>No products found</h5>
        <p class="text-muted">Start by adding your first product to the catalog.</p>
        <button class="btn btn-primary" (click)="openAddModal()">
          <i class="fas fa-plus me-2"></i>Add Product
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Add/Edit Product Modal -->
<div class="modal fade" [class.show]="showAddModal || showEditModal" [style.display]="(showAddModal || showEditModal) ? 'block' : 'none'">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ showEditModal ? 'Edit Product' : 'Add New Product' }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="name" class="form-label">Product Name</label>
              <input 
                type="text" 
                class="form-control" 
                id="name" 
                formControlName="name"
                [class.is-invalid]="productForm.get('name')?.invalid && productForm.get('name')?.touched"
              >
              <div class="invalid-feedback" *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched">
                {{ getErrorMessage('name') }}
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="category" class="form-label">Category</label>
              <select 
                class="form-select" 
                id="category" 
                formControlName="category"
                [class.is-invalid]="productForm.get('category')?.invalid && productForm.get('category')?.touched"
              >
                <option value="">Select Category</option>
                <option value="cotton">Cotton</option>
                <option value="silk">Silk</option>
                <option value="wool">Wool</option>
                <option value="synthetic">Synthetic</option>
              </select>
              <div class="invalid-feedback" *ngIf="productForm.get('category')?.invalid && productForm.get('category')?.touched">
                {{ getErrorMessage('category') }}
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea 
              class="form-control" 
              id="description" 
              rows="3" 
              formControlName="description"
              [class.is-invalid]="productForm.get('description')?.invalid && productForm.get('description')?.touched"
            ></textarea>
            <div class="invalid-feedback" *ngIf="productForm.get('description')?.invalid && productForm.get('description')?.touched">
              {{ getErrorMessage('description') }}
            </div>
          </div>

          <div class="row">
            <div class="col-md-4 mb-3">
              <label for="price" class="form-label">Price</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input 
                  type="number" 
                  class="form-control" 
                  id="price" 
                  formControlName="price"
                  [class.is-invalid]="productForm.get('price')?.invalid && productForm.get('price')?.touched"
                >
              </div>
              <div class="invalid-feedback" *ngIf="productForm.get('price')?.invalid && productForm.get('price')?.touched">
                {{ getErrorMessage('price') }}
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <label for="stockQuantity" class="form-label">Stock Quantity</label>
              <input 
                type="number" 
                class="form-control" 
                id="stockQuantity" 
                formControlName="stockQuantity"
                [class.is-invalid]="productForm.get('stockQuantity')?.invalid && productForm.get('stockQuantity')?.touched"
              >
              <div class="invalid-feedback" *ngIf="productForm.get('stockQuantity')?.invalid && productForm.get('stockQuantity')?.touched">
                {{ getErrorMessage('stockQuantity') }}
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <label for="unit" class="form-label">Unit</label>
              <select 
                class="form-select" 
                id="unit" 
                formControlName="unit"
                [class.is-invalid]="productForm.get('unit')?.invalid && productForm.get('unit')?.touched"
              >
                <option value="">Select Unit</option>
                <option value="meters">Meters</option>
                <option value="yards">Yards</option>
                <option value="pieces">Pieces</option>
                <option value="kg">Kilograms</option>
              </select>
              <div class="invalid-feedback" *ngIf="productForm.get('unit')?.invalid && productForm.get('unit')?.touched">
                {{ getErrorMessage('unit') }}
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="subcategory" class="form-label">Subcategory</label>
              <input 
                type="text" 
                class="form-control" 
                id="subcategory" 
                formControlName="subcategory"
                [class.is-invalid]="productForm.get('subcategory')?.invalid && productForm.get('subcategory')?.touched"
              >
              <div class="invalid-feedback" *ngIf="productForm.get('subcategory')?.invalid && productForm.get('subcategory')?.touched">
                {{ getErrorMessage('subcategory') }}
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="minOrderQuantity" class="form-label">Minimum Order Quantity</label>
              <input 
                type="number" 
                class="form-control" 
                id="minOrderQuantity" 
                formControlName="minOrderQuantity"
                [class.is-invalid]="productForm.get('minOrderQuantity')?.invalid && productForm.get('minOrderQuantity')?.touched"
              >
              <div class="invalid-feedback" *ngIf="productForm.get('minOrderQuantity')?.invalid && productForm.get('minOrderQuantity')?.touched">
                {{ getErrorMessage('minOrderQuantity') }}
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for="imageUrl" class="form-label">Image URL</label>
            <input 
              type="url" 
              class="form-control" 
              id="imageUrl" 
              formControlName="imageUrl"
              [class.is-invalid]="productForm.get('imageUrl')?.invalid && productForm.get('imageUrl')?.touched"
            >
            <div class="invalid-feedback" *ngIf="productForm.get('imageUrl')?.invalid && productForm.get('imageUrl')?.touched">
              {{ getErrorMessage('imageUrl') }}
            </div>
          </div>

          <div class="form-check">
            <input 
              class="form-check-input" 
              type="checkbox" 
              id="isActive" 
              formControlName="isActive"
            >
            <label class="form-check-label" for="isActive">
              Product is active and available for purchase
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="productForm.invalid">
            {{ showEditModal ? 'Update Product' : 'Add Product' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Backdrop -->
<div class="modal-backdrop fade show" *ngIf="showAddModal || showEditModal"></div>
